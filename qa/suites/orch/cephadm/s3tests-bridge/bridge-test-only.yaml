roles:
- [host.a, mon.a, mgr.a, osd.0, osd.1, osd.2, client.0]

tasks:
- cephadm:

- cephadm.apply:
    specs:
      - service_type: rgw
        service_id: test
        placement:
          host_pattern: "*"
        spec:
          rgw_frontend_port: 8080

- cephadm.wait_for_service:
    service: rgw.test

- cephadm_s3_bridge:
    client.0:
      discover_from_cephadm: true
- cephadm.shell:
    host.a:
      - ceph osd pool ls detail
      - ceph orch ls
      - ceph orch ps
- rgw:
    client.0:
 
