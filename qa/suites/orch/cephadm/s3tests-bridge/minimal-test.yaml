roles:
- [host.a, mon.a, mgr.a, osd.0, osd.1, osd.2, client.0]

tasks:
- cephadm:

- cephadm.apply:
    specs:
      - service_type: rgw
        service_id: test
        placement:
          host_pattern: "*"
        spec:
          rgw_frontend_port: 8080

- cephadm.wait_for_service:
    service: rgw.test

- cephadm_s3_bridge:
    client.0:
      discover_from_cephadm: true
      dns_name: client.0

- tox: [client.0]

- s3tests:
    client.0:
      rgw_server: client.0
      force-branch: master
      conf:
        DEFAULT:
          is_secure: false
          port: 8080
          calling_format: ordinary
        fixtures:
          bucket prefix: s3test-{random}-
        # POC run
        exclude:
          - test_bucket_policy*
          - test_lifecycle*  
          - test_encryption*
          - test_multipart_upload_size_too_small
          - test_cors*
          - test_website*
          - test_logging*
          - test_versioning*
      filter: "test_bucket_list_empty or test_bucket_create or test_object_write or test_object_read"
